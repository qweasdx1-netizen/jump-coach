<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jump Coach - Polished</title>
    <style>
        /* ================= VARIABLES ================= */
        :root {
            --bg-body: #F5F3EB;       
            --bg-sidebar: #EAE4D3;
            --bg-card: #FBF9F3;       
            --bg-ui-element: #DED5BD; 

            --text-main: #1A1A1A;     
            --text-sub: #555555;      
            --text-muted: #999999;    
            --text-on-accent: #222222;

            --border: #D8D2C0;        
            --accent-color: #EDA82F;  
            --test-gradient: linear-gradient(135deg, #E15555 0%, #C73E3E 100%);

            --radius-lg: 20px;
            --radius-md: 12px;
            
            --sidebar-width: 220px; 
            --panel-width: 360px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Inter", "PingFang SC", "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            font-size: 15px;
        }

        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #D4CDB7; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #B0A890; }

        /* ================= SIDEBAR ================= */
        aside.sidebar {
            width: var(--sidebar-width); min-width: var(--sidebar-width);
            background: var(--bg-sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 24px 16px;
            overflow-y: auto; flex-shrink: 0;
        }

        .logo-area { font-size: 20px; font-weight: 900; margin-bottom: 30px; color: var(--text-main); display: flex; align-items: center; gap: 8px; padding-left: 8px; }
        .phase-section { margin-bottom: 24px; }
        .phase-label { font-size: 11px; text-transform: uppercase; color: var(--text-sub); font-weight: 700; margin-bottom: 8px; padding-left: 10px; opacity: 0.6; letter-spacing: 0.5px; }

        .week-btn {
            width: 100%; text-align: left; padding: 10px 14px; border-radius: var(--radius-md); 
            border: 1px solid transparent; background: transparent; color: var(--text-sub); 
            font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 4px; 
            display: flex; justify-content: space-between; align-items: center; transition: all 0.2s;
        }
        .week-btn:hover { background: rgba(0,0,0,0.05); color: var(--text-main); }
        .week-btn.active { background: var(--accent-color); color: var(--text-on-accent); box-shadow: 0 4px 12px rgba(237, 168, 47, 0.25); }
        .week-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-muted); opacity: 0.5; }
        .week-btn.active .week-dot { background: var(--text-on-accent); opacity: 1; }

        /* ================= MAIN AREA ================= */
        main.workout-area {
            flex: 1; padding: 30px 50px; overflow-y: auto; display: flex; flex-direction: column;
            background: var(--bg-body); min-width: 450px;
        }

        header.top-bar { margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .page-title h1 { font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -0.5px; color: var(--text-main); }
        .page-title p { color: var(--text-sub); margin: 4px 0 0 0; font-size: 14px; font-weight: 500; }

        .day-switcher { display: flex; background: var(--bg-ui-element); padding: 4px; border-radius: 100px; }
        .day-tab { padding: 8px 20px; border: none; background: transparent; font-weight: 700; font-size: 13px; cursor: pointer; border-radius: 100px; color: var(--text-sub); transition: 0.2s; white-space: nowrap; }
        .day-tab.active { background: var(--accent-color); color: var(--text-on-accent); box-shadow: 0 2px 8px rgba(237, 168, 47, 0.15); }

        .workout-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.02); }
        .workout-card.context-test { border: 2px solid #E15555; }

        .exercise-row { padding: 18px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background 0.15s; }
        .exercise-row:hover { background-color: #F2F0E6; }
        .exercise-row.selected { background-color: #EFECE0; border-left: 4px solid var(--accent-color); padding-left: 20px;}
        .exercise-row:last-child { border-bottom: none; }

        .ex-info { flex: 1; padding-right: 15px; }
        .ex-title { font-size: 16px; font-weight: 700; display: block; margin-bottom: 4px; color: var(--text-main); }
        .ex-meta { font-size: 13px; color: var(--text-sub); display: flex; align-items: center; gap: 8px; font-weight: 500; }
        
        .badge { display: inline-block; background: var(--bg-ui-element); padding: 2px 8px; border-radius: 6px; font-weight: 700; font-size: 11px; }
        .badge.test-badge { background: var(--test-gradient); color: white; }

        .sets-wrapper { display: flex; gap: 6px; }
        .set-bubble { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: var(--text-sub); cursor: pointer; background: #FFF; transition: 0.1s; }
        .set-bubble:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .set-bubble.completed { background: var(--accent-color); border-color: var(--accent-color); color: var(--text-on-accent); transform: scale(1.1); }
        .context-test .set-bubble.completed { background: var(--test-gradient); border: none; color: white; }

        .complex-label { background: #EFECE0; color: var(--text-main); padding: 10px 24px; font-size: 12px; font-weight: 800; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 6px; }

        .knowledge-card { background: #EFECE0; border: 1px solid #D4CDB7; border-radius: var(--radius-md); padding: 20px; margin-bottom: 20px; }
        .knowledge-header { font-size: 14px; font-weight: 800; margin-bottom: 8px; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .knowledge-text { font-size: 13px; line-height: 1.6; color: var(--text-sub); }

        .journal-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 20px; margin-bottom: 100px; /* Extra space at bottom */ }
        .journal-header { font-size: 14px; font-weight: 700; margin-bottom: 12px; }
        .journal-input { width: 100%; height: 80px; border: 1px solid var(--border); border-radius: 8px; padding: 12px; font-family: inherit; font-size: 14px; background: var(--bg-body); resize: none; outline: none; transition: border 0.2s; }
        .journal-input:focus { border-color: var(--accent-color); background: #FFF; }

        /* ================= SPLITTER ================= */
        .splitter { width: 12px; background: transparent; cursor: col-resize; flex-shrink: 0; margin: 0 -6px; z-index: 100; position: relative; }
        .splitter::after { content: ''; position: absolute; top: 0; bottom: 0; left: 50%; width: 0px; background: var(--accent-color); transition: 0.2s; opacity: 0; }
        .splitter:hover::after { width: 4px; opacity: 0.5; }
        body.resizing .splitter::after { width: 4px; opacity: 1; }

        /* ================= RIGHT PANEL ================= */
        aside.coach-panel {
            width: var(--panel-width); min-width: 300px; max-width: 50vw; 
            background: var(--bg-body); border-left: 1px solid transparent; 
            display: flex; flex-direction: column; flex-shrink: 0; z-index: 50;
        }
        .panel-tabs { display: flex; border-bottom: 1px solid var(--border); background: var(--bg-body); padding: 0 16px; margin-top: 20px; flex-shrink: 0; }
        .panel-tab-btn { flex: 1; padding: 14px; border: none; background: transparent; font-weight: 700; cursor: pointer; color: var(--text-sub); font-size: 14px; position: relative; }
        .panel-tab-btn.active { color: var(--text-main); }
        .panel-tab-btn.active::after { content: ''; position: absolute; bottom: -1px; left: 25%; width: 50%; height: 3px; background: var(--accent-color); }
        
        .panel-content { flex: 1; padding: 30px; overflow-y: auto; }
        .panel-view { display: none; }
        .panel-view.active { display: block; animation: fadeIn 0.3s; }

        .visual-box { width: 100%; height: 200px; background: linear-gradient(135deg, #F0EAE0 0%, #E5DDC5 100%); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; margin-bottom: 20px; border: 1px solid var(--border); padding: 20px; }
        .stick-figure-svg { width: 100%; height: 100%; stroke: var(--text-main); stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; fill: none; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .tip-card { background: var(--bg-card); padding: 20px; border-radius: var(--radius-md); border: 1px solid var(--border); margin-bottom: 16px; }
        .tip-title { font-size: 12px; font-weight: 800; margin-bottom: 10px; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; }
        .tip-list { padding-left: 18px; margin: 0; font-size: 14px; line-height: 1.6; color: var(--text-main); }
        .tip-list li { margin-bottom: 6px; }
        /* Font style normal for better readability */
        .script-text { font-size: 15px; color: var(--text-main); line-height: 1.6; font-weight: 500; font-style: normal; }

        .btn-speak-large { width: 100%; padding: 14px; background: var(--accent-color); color: var(--text-on-accent); border: none; border-radius: var(--radius-md); font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.1s; margin-bottom: 120px; }
        .btn-speak-large:active { transform: scale(0.98); }
        .btn-test-day { background: var(--test-gradient); color: #FFF; }

        .rec-card { background: var(--bg-card); padding: 16px; border-radius: var(--radius-md); border: 1px solid var(--border); margin-bottom: 12px; }
        .rec-icon-title { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
        .rec-icon { font-size: 20px; }
        .rec-title-en { font-size: 14px; font-weight: 800; color: var(--text-main); }
        .rec-desc-cn { font-size: 13px; color: var(--text-main); line-height: 1.4; }
        .rec-type-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 700; margin: 24px 0 12px 0; display: block; border-bottom: 1px solid var(--border); padding-bottom: 4px; }

        /* MUSIC PLAYER */
        .music-player-widget { position: fixed; bottom: 20px; right: 20px; width: 260px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 14px; padding: 10px 14px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); z-index: 1000; display: flex; align-items: center; gap: 12px; }
        .album-art { width: 36px; height: 36px; background: var(--accent-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .track-info { flex: 1; overflow: hidden; }
        .track-name { display: block; font-size: 12px; font-weight: 700; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .artist-name { display: block; font-size: 10px; color: var(--text-sub); }
        .controls { display: flex; gap: 8px; align-items: center; }
        .ctrl-btn { background: transparent; border: none; font-size: 16px; cursor: pointer; color: var(--text-main); padding: 0; }
        .play-pause-btn { width: 28px; height: 28px; background: var(--text-main); color: #FFF; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: none; cursor: pointer; }

        body.resizing { cursor: col-resize; user-select: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo-area"><span style="color:var(--accent-color)">ğŸ€</span> Jump Coach</div>
        <div id="nav-container"></div>
    </aside>

    <main class="workout-area">
        <header class="top-bar">
            <div class="page-title"><h1 id="main-title">Week 1</h1><p id="main-subtitle">Focus</p></div>
            <div class="day-switcher">
                <button class="day-tab active" onclick="setDay('tue')">å‘¨äºŒ</button>
                <button class="day-tab" onclick="setDay('thu')">å‘¨å››</button>
                <button class="day-tab" onclick="setDay('sat')">å‘¨æœ«</button>
            </div>
        </header>

        <div class="workout-card" id="workout-list"></div>
        
        <div class="knowledge-card">
            <div class="knowledge-header"><span style="font-size:18px;">ğŸ§ </span> è®­ç»ƒé€»è¾‘</div>
            <div id="knowledge-content" class="knowledge-text"></div>
        </div>

        <div class="journal-section">
            <div class="journal-header">ğŸ“ è®­ç»ƒæ—¥å¿—</div>
            <textarea id="journal-input" class="journal-input" placeholder="è®°å½•ä»Šæ—¥æ„Ÿå—..." oninput="saveJournal()"></textarea>
            <div style="text-align:right; font-size:12px; color:var(--text-muted); margin-top:8px;" id="save-msg"></div>
        </div>
    </main>

    <div class="splitter" id="splitter"></div>

    <aside class="coach-panel" id="right-panel">
        <div class="panel-tabs">
            <button class="panel-tab-btn active" onclick="switchRightTab('coach')">åŠ¨ä½œæŒ‡å¯¼</button>
            <button class="panel-tab-btn" onclick="switchRightTab('recovery')">æ¢å¤å»ºè®®</button>
        </div>
        <div class="panel-content">
            <div id="view-coach" class="panel-view active">
                <div id="coach-content-inner">
                    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:300px; color:var(--text-muted); text-align:center;">
                        <div style="font-size:50px; margin-bottom:16px; opacity:0.3;">ğŸ‘ˆ</div>
                        <div style="font-weight:600; font-size:15px;">è¯·ç‚¹å‡»å·¦ä¾§åŠ¨ä½œ<br>æŸ¥çœ‹å›¾è§£ä¸æŒ‡å¯¼</div>
                    </div>
                </div>
            </div>
            <div id="view-recovery" class="panel-view">
                <div id="recovery-content"></div>
            </div>
        </div>
    </aside>

    <div class="music-player-widget">
        <div class="album-art">ğŸµ</div>
        <div class="track-info"><span class="track-name" id="track-name">Focus Flow</span><span class="artist-name" id="artist-name">Lofi Beats</span></div>
        <div class="controls"><button class="ctrl-btn" onclick="prevTrack()">â®</button><button class="play-pause-btn" id="play-btn" onclick="togglePlay()">â–¶</button><button class="ctrl-btn" onclick="nextTrack()">â­</button></div>
    </div>
    <audio id="audio-player" loop><source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3" type="audio/mpeg"></audio>

    <script>
        const svgs = {
            squat: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="20" r="8" /><path d="M50 28 L50 60 M50 60 L30 85 M50 60 L70 85 M30 40 L70 40 M30 40 L30 50 M70 40 L70 50" /><line x1="20" y1="42" x2="80" y2="42" stroke-width="4" stroke="#555" /></svg>`,
            deadlift: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="70" cy="30" r="8" /><path d="M70 38 L40 60 M40 60 L40 90 M40 60 L60 90 M70 38 L55 55" /><line x1="30" y1="85" x2="60" y2="85" stroke-width="4" stroke="#555" /><circle cx="35" cy="85" r="5" fill="#555" /></svg>`,
            clean: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="20" r="8" /><path d="M50 28 L50 60 M50 60 L35 90 M50 60 L65 90 M50 35 L30 30 M50 35 L70 30" /><line x1="20" y1="30" x2="80" y2="30" stroke-width="4" stroke="#555" /><path d="M25 30 L30 45 M75 30 L70 45" /></svg>`,
            jump: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="15" r="8" /><path d="M50 23 L50 50 M50 50 L30 70 M50 50 L70 65 M50 30 L20 10 M50 30 L80 10" /><path d="M20 90 Q50 80 80 90" stroke="#DDD" stroke-width="2" fill="none"/></svg>`,
            swing: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="25" r="8" /><path d="M50 33 L50 60 M50 60 L35 90 M50 60 L65 90 M50 35 L30 50 M50 35 L70 50" /><circle cx="50" cy="55" r="6" fill="#555" /></svg>`,
            lunge: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="20" r="8" /><path d="M50 28 L50 55 M50 55 L25 80 M25 80 L25 95 M50 55 L75 80 M75 80 L75 95 M50 35 L30 50 M50 35 L70 50" /></svg>`,
            boxjump: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><rect x="60" y="60" width="30" height="30" fill="none" stroke="#555" stroke-width="3"/><circle cx="30" cy="25" r="8" /><path d="M30 33 L30 55 M30 55 L15 70 M30 55 L45 65 M30 40 L10 25 M30 40 L50 30" /></svg>`,
            run: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="60" cy="20" r="8" /><path d="M60 28 L50 50 M50 50 L30 60 M50 50 L70 65 M50 35 L30 30 M50 35 L70 40" /></svg>`,
            rest: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><circle cx="50" cy="30" r="8" /><path d="M50 38 L50 65 M50 65 L30 85 M50 65 L70 85 M30 50 L70 50" /><path d="M20 85 L80 85" stroke="#555" /></svg>`,
            test: `<svg viewBox="0 0 100 100" class="stick-figure-svg"><path d="M20 80 L40 60 L60 70 L80 30" stroke="#EDA82F" stroke-width="4" fill="none" /><circle cx="80" cy="30" r="4" fill="#EDA82F" /></svg>`
        };

        const splitter = document.getElementById('splitter'), rightPanel = document.getElementById('right-panel');
        let isDragging = false;
        splitter.addEventListener('mousedown', () => { isDragging = true; document.body.classList.add('resizing'); });
        document.addEventListener('mousemove', (e) => { if(!isDragging)return; const w = window.innerWidth - e.clientX; if(w>300 && w<window.innerWidth*0.6) rightPanel.style.width = `${w}px`; });
        document.addEventListener('mouseup', () => { isDragging = false; document.body.classList.remove('resizing'); });

        const tracks = [{name:"Focus Flow",artist:"Lofi Beats",url:"https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3"},{name:"Hype Mode",artist:"Phonk",url:"https://cdn.pixabay.com/download/audio/2022/03/24/audio_07823d0676.mp3?filename=trap-future-bass-royalty-free-music-110067.mp3"},{name:"Test Day",artist:"Epic",url:"https://cdn.pixabay.com/download/audio/2022/10/25/audio_5e2d861619.mp3?filename=action-rock-124036.mp3"}];
        let trkIdx=0, isPlay=false; const aud=document.getElementById('audio-player');
        function togglePlay(){if(isPlay){aud.pause();document.getElementById('play-btn').innerText="â–¶";}else{aud.play().catch(e=>alert("ç‚¹å‡»é¡µé¢å³å¯æ’­æ”¾"));document.getElementById('play-btn').innerText="â¸";}isPlay=!isPlay;}
        function nextTrack(){trkIdx=(trkIdx+1)%tracks.length;loadTrack();}
        function prevTrack(){trkIdx=(trkIdx-1+tracks.length)%tracks.length;loadTrack();}
        function loadTrack(){const t=tracks[trkIdx];document.getElementById('track-name').innerText=t.name;document.getElementById('artist-name').innerText=t.artist;aud.src=t.url;if(isPlay)aud.play();}

        const knowledgeDB = {
            1: "<b>Phase I (åŸºç¡€æœŸ)</b>ï¼šå°±åƒç›–æ¥¼å…ˆæ‰“åœ°åŸºã€‚æˆ‘ä»¬ç”¨ 70-80% çš„é‡é‡å¢åŠ è‚Œè‚‰é‡å’Œè‚Œè…±å¼ºåº¦ã€‚åªæœ‰åº•åº§å¤Ÿå®½ï¼Œå¡”å°–æ‰èƒ½æ›´é«˜ã€‚",
            2: "<b>Phase II (è½¬åŒ–æœŸ)</b>ï¼šå¼•å…¥ PAPEï¼ˆåæ¿€æ´»å¢å¼ºï¼‰ã€‚å…ˆåšå¤§é‡é‡æ·±è¹²æ¿€æ´»ç¥ç»ï¼Œç«‹åˆ»åšè½»é‡é‡è·³è·ƒï¼Œåˆ©ç”¨ç¥ç»å…´å¥‹æœŸçªç ´æé™ã€‚",
            3: "<b>Phase III (å³°å€¼æœŸ)</b>ï¼šå‡é‡ï¼ˆDeloadï¼‰æ˜¯å…³é”®ã€‚ç–²åŠ³æ¶ˆæ•£åï¼Œä½ çš„çœŸå®ä½“èƒ½æ‰ä¼šæ˜¾ç°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæµ‹è¯•å‰è¦å°‘ç»ƒã€‚"
        };
        const phases={1:{name:"Phase I",sub:"åŸºç¡€åŠ›é‡",focus:"Zone 2/3"},2:{name:"Phase II",sub:"åŠ›é‡è½¬åŒ–",focus:"PAPE Complex"},3:{name:"Phase III",sub:"å³°å€¼æµ‹è¯•",focus:"Peaking"}};
        const recoveryDatabase={general:[{icon:"ğŸ›Œ",titleEn:"Sleep",titleCn:"ç¡çœ ",descEn:"8h+",descCn:"8å°æ—¶+"},{icon:"ğŸ¥©",titleEn:"Protein",titleCn:"è›‹ç™½",descEn:"30g",descCn:"ç»ƒå30å…‹"}],1:[{icon:"ğŸ¦µ",titleEn:"Foam Roll",titleCn:"æ³¡æ²«è½´",descEn:"Quads",descCn:"æ”¾æ¾å¤§è…¿"},{icon:"ğŸ›",titleEn:"Hot Bath",titleCn:"çƒ­æ°´æµ´",descEn:"Relax",descCn:"æ”¾æ¾è‚Œè‚‰"}],2:[{icon:"ğŸš¿",titleEn:"Contrast",titleCn:"å†·çƒ­æµ´",descEn:"Hot/Cold",descCn:"å†·çƒ­äº¤æ›¿"},{icon:"ğŸ§˜",titleEn:"CNS",titleCn:"ç¥ç»",descEn:"Meditate",descCn:"å†¥æƒ³"}],3:[{icon:"ğŸš¶",titleEn:"Active",titleCn:"ä¸»åŠ¨",descEn:"Walk",descCn:"è½»åº¦æ´»åŠ¨"},{icon:"ğŸ”‹",titleEn:"Rest",titleCn:"ä¼‘æ¯",descEn:"Full",descCn:"å®Œå…¨ä¼‘æ¯"}]};
        const workoutDB={
            1:{tue:[{id:"p1_warm",name:"Dynamic Warm Up",cn:"åŠ¨æ€çƒ­èº«",sets:1,reps:"10m",load:"-",icon:"run",tips:["æ¿€æ´»è‡€éƒ¨"]},{id:"p1_sq",name:"Back Squat",cn:"èƒŒè¹²",sets:3,reps:"8-10",baseLoad:63,rest:"120s",type:"heavy",icon:"squat",tips:["æŒºèƒ¸æ”¶è…¹","è†ç›–å¯¹å‡†è„šå°–"]},{id:"p1_dl",name:"Deadlift",cn:"ç¡¬æ‹‰",sets:3,reps:"8",baseLoad:74,rest:"120s",type:"heavy",icon:"deadlift",tips:["èƒŒéƒ¨æŒºç›´"]},{id:"p1_kb",name:"KB Swing",cn:"å£¶é“ƒæ‘‡æ‘†",sets:3,reps:"10",load:"Heavy",rest:"60s",type:"power",icon:"swing",tips:["çˆ†å‘ä¼¸é«‹"]}],thu:[{id:"p1_cl",name:"Hang Clean",cn:"é«˜ä½ç¿»",sets:4,reps:"6",baseLoad:50,rest:"60s",type:"speed",icon:"clean",tips:["é€Ÿåº¦ç¬¬ä¸€"]},{id:"p1_bj",name:"Box Jump",cn:"ç®±å¼è·³",sets:5,reps:"3",load:"Body",rest:"60s",type:"plyo",icon:"boxjump",tips:["è½»ç›ˆè½åœ°"]},{id:"p1_sl",name:"SL Deadlift",cn:"å•è…¿ç¡¬æ‹‰",sets:3,reps:"12",load:"DB",rest:"60s",type:"acc",icon:"lunge",tips:["ä¿æŒå¹³è¡¡"]}],sat:[{id:"p1_js",name:"Jump Squat",cn:"æ·±è¹²è·³",sets:4,reps:"8",load:"Empty",rest:"60s",type:"plyo",icon:"jump",tips:["æœ€å¤§é«˜åº¦"]},{id:"p1_sp",name:"Sled Push",cn:"æ¨é›ªæ©‡",sets:4,reps:"15m",load:"Light",rest:"60s",type:"speed",icon:"run",tips:["å…¨é€Ÿå†²åˆº"]}]},
            2:{tue:[{id:"p2_warm",name:"Warm Up",cn:"çƒ­èº«",sets:1,reps:"10m",load:"-",icon:"run",tips:["ç¥ç»æ¿€æ´»"]},{isComplex:true,items:[{id:"p2_sq",name:"Back Squat",cn:"èƒŒè¹²(85%)",sets:4,reps:"5",baseLoad:76,rest:"3min",type:"heavy",icon:"squat",tips:["å¤§é‡é‡"]},{id:"p2_js",name:"Jump Squat",cn:"æ·±è¹²è·³",sets:4,reps:"5",load:"Light",rest:"90s",type:"plyo",icon:"jump",tips:["PAPE"]}]},{id:"p2_cl",name:"Hang Clean",cn:"é«˜ä½ç¿»",sets:4,reps:"3",baseLoad:72,rest:"90s",type:"speed",icon:"clean",tips:["å¿«é€Ÿå‡ºè‚˜"]}],thu:[{id:"p2_dl",name:"DL+Band",cn:"å¼¹åŠ›å¸¦ç¡¬æ‹‰",sets:3,reps:"5",baseLoad:74,rest:"120s",type:"heavy",icon:"deadlift",tips:["åŠ é€Ÿ"]},{id:"p2_dj",name:"Depth Jump",cn:"æ·±åº¦è·³è·ƒ",sets:2,reps:"5",load:"Low Box",rest:"90s",type:"plyo",icon:"boxjump",tips:["è§¦åœ°å³èµ·"]},{id:"p2_cr",name:"Calf Raise",cn:"æè¸µ",sets:3,reps:"12",load:"Weight",rest:"60s",type:"acc",icon:"rest",tips:["å¿«èµ·æ…¢è½"]}],sat:[{id:"p2_sbj",name:"Seated Box Jump",cn:"åå¼è·³",sets:4,reps:"4",load:"Body",rest:"90s",type:"plyo",icon:"boxjump",tips:["æ¶ˆé™¤é¢„æ‹‰ä¼¸"]},{id:"p2_core",name:"Core",cn:"æ ¸å¿ƒ",sets:3,reps:"15",load:"Mix",rest:"60s",type:"acc",icon:"rest",tips:["å¹³æ¿æ”¯æ’‘"]}]},
            3:{tue:[{id:"p3_warm",name:"Warm Up",cn:"çƒ­èº«",sets:1,reps:"10m",load:"-",icon:"run",tips:["å‡†å¤‡"]},{id:"p3_sq",name:"Back Squat",cn:"èƒŒè¹²(90%)",sets:2,reps:"3",baseLoad:81,rest:"120s",type:"heavy",icon:"squat",tips:["å³°å€¼"]},{id:"p3_dj",name:"Depth Jump",cn:"æ·±åº¦è·³",sets:4,reps:"3",load:"Med Box",rest:"90s",type:"plyo",icon:"boxjump",tips:["åŠŸç‡"]},{id:"p3_ds",name:"Drop Snatch",cn:"ä¸‹è¹²æŠ“",sets:3,reps:"2",load:"Light",rest:"60s",type:"speed",icon:"clean",tips:["æ”¯æ’‘"]}],thu:[{id:"p3_del",name:"Active Recovery",cn:"å‡è½½",sets:3,reps:"15",load:"<50%",rest:"60s",type:"acc",icon:"rest",tips:["ä¸è¦ç–²åŠ³"]},{id:"p3_sw",name:"Exp KB Swing",cn:"çˆ†å‘æ‘‡æ‘†",sets:3,reps:"10",load:"Light",rest:"60s",type:"speed",icon:"swing",tips:["é€Ÿåº¦"]}],sat:[{id:"p3_test",name:"MAX VERTICAL",cn:"å…¨åŠ›æ‘¸é«˜",sets:5,reps:"1",load:"MAX",rest:"5min",type:"test",icon:"test",tips:["æ‰“ç ´çºªå½•ï¼"]},{id:"p3_dunk",name:"Dunk Attempt",cn:"æ‰£ç¯®å°è¯•",sets:1,reps:"Free",load:"ğŸ€",rest:"Fun",type:"test",icon:"jump",tips:["äº«å—é£è¡Œ"]}]}
        };

        let currentWeek=1, currentDay='tue', currentPhase=1;
        window.onload=function(){renderSidebar();renderWorkout();loadJournal();renderRecovery();}

        function renderSidebar(){
            const c=document.getElementById('nav-container'); let h='';
            const btn=(w)=>`<button class="week-btn ${w===currentWeek?'active':''}" onclick="setWeek(${w})"><span>Week ${w}</span><span class="week-dot"></span></button>`;
            h+=`<div class="phase-section"><div class="phase-label">Phase I</div>${[1,2,3,4].map(btn).join('')}</div>`;
            h+=`<div class="phase-section"><div class="phase-label">Phase II</div>${[5,6,7,8].map(btn).join('')}</div>`;
            h+=`<div class="phase-section"><div class="phase-label">Phase III</div>${[9,10].map(btn).join('')}</div>`;
            c.innerHTML=h;
        }
        function renderWorkout(){
            document.getElementById('main-title').innerText=`Week ${currentWeek}`;
            document.getElementById('main-subtitle').innerText=phases[currentPhase].sub;
            document.getElementById('knowledge-content').innerHTML = knowledgeDB[currentPhase];
            const l=document.getElementById('workout-list'); l.innerHTML=''; l.className='workout-card';
            if(currentPhase===3&&currentDay==='sat')l.classList.add('context-test');
            const routine=workoutDB[currentPhase][currentDay]||[];
            routine.forEach(item=>{
                if(item.isComplex){
                    const div=document.createElement('div'); div.className='complex-label'; div.innerText='ğŸ”¥ PAPE COMPLEX'; l.appendChild(div);
                    item.items.forEach(s=>l.appendChild(createRow(s)));
                }else l.appendChild(createRow(item));
            });
            loadJournal();
        }
        function createRow(ex){
            const d=document.createElement('div'); d.className='exercise-row'; d.onclick=()=>showCoach(ex,d);
            
            // LOGIC FIX: UNDEFINED HANDLING
            let load=""; 
            if(ex.baseLoad && typeof ex.baseLoad === 'number'){
                let s=currentPhase===1?1:(currentPhase===2?5:9); 
                load=Math.round(ex.baseLoad+(currentWeek-s)*2.5)+" kg";
            } else if(ex.load && ex.load !== "-") {
                load = ex.load;
            }
            // Logic: Only show badge if load exists
            let badgeHtml = load ? `<span class="${ex.type==='test'?'badge test-badge':'badge'}" style="margin-left:8px">${load}</span>` : '';
            
            // Logic: Only show rest if rest exists and is not 'undefined' string
            let restText = (ex.rest && ex.rest !== 'undefined') ? 
                `<span style="width:1px;height:12px;background:var(--border);margin:0 8px;"></span> Rest ${ex.rest}` : '';

            let bub=''; for(let i=1;i<=ex.sets;i++){const id=`w${currentWeek}_${currentDay}_${ex.id}_s${i}`; const done=localStorage.getItem(id)==='true'; bub+=`<div class="set-bubble ${done?'completed':''}" onclick="toggleSet(event,'${id}',this)">${i}</div>`;}
            
            d.innerHTML=`<div class="ex-info"><span class="ex-title">${ex.name}<span style="font-weight:500;font-size:16px;color:var(--text-sub);margin-left:8px;">${ex.cn}</span></span><div class="ex-meta">${ex.sets} Sets / ${ex.reps} Reps ${restText} ${badgeHtml}</div></div><div class="sets-wrapper">${bub}</div>`;
            return d;
        }
        function showCoach(ex,el){
            document.querySelectorAll('.exercise-row').forEach(r=>r.classList.remove('selected')); el.classList.add('selected'); switchRightTab('coach');
            let script=generateScript(ex); const cls=ex.type==='test'?'btn-speak-large btn-test-day':'btn-speak-large';
            const svgCode = svgs[ex.icon] || svgs['squat'];
            document.getElementById('coach-content-inner').innerHTML=`<div class="visual-box">${svgCode}</div><div class="tip-card"><div class="tip-title">ğŸ“‹ Coach Script</div><div class="script-text">"${script}"</div></div><div class="tip-card"><div class="tip-title">ğŸ’¡ Key Points</div><ul class="tip-list">${ex.tips.map(t=>`<li>${t}</li>`).join('')}</ul></div><button class="${cls}" onclick="speak('${script}')">ğŸ”Š Play Guidance</button>`;
        }
        function generateScript(ex){
            let load=ex.load||""; 
            if(ex.baseLoad && typeof ex.baseLoad === 'number'){
                let s=currentPhase===1?1:(currentPhase===2?5:9); load=Math.round(ex.baseLoad+(currentWeek-s)*2.5)+"å…¬æ–¤";
            }
            if(ex.type==='test') return `ä»Šå¤©æ˜¯å†³æˆ˜æ—¶åˆ»ï¼${ex.cn}ã€‚å…¨åŠ›ä»¥èµ´ï¼Œæ‰“ç ´çºªå½•ï¼`;
            const tips=ex.tips?`å…³é”®ç‚¹ï¼š${ex.tips.slice(0,2).join("ï¼Œ")}ã€‚`:"";
            return `å‡†å¤‡ï¼Œ${ex.cn}ã€‚${load}ï¼Œ${ex.sets}ç»„ï¼Œæ¯ç»„${ex.reps}ã€‚${tips} åŠ æ²¹ï¼`;
        }
        function setWeek(w){currentWeek=w; if(w<=4)currentPhase=1;else if(w<=8)currentPhase=2;else currentPhase=3; renderSidebar();renderWorkout();renderRecovery();}
        function setDay(d){currentDay=d; document.querySelectorAll('.day-tab').forEach(b=>b.classList.remove('active')); if(d==='tue')document.querySelectorAll('.day-tab')[0].classList.add('active'); if(d==='thu')document.querySelectorAll('.day-tab')[1].classList.add('active'); if(d==='sat')document.querySelectorAll('.day-tab')[2].classList.add('active'); renderWorkout();}
        function switchRightTab(t){document.querySelectorAll('.panel-tab-btn').forEach(b=>b.classList.remove('active')); document.querySelectorAll('.panel-view').forEach(v=>v.classList.remove('active')); if(t==='coach'){document.querySelectorAll('.panel-tab-btn')[0].classList.add('active');document.getElementById('view-coach').classList.add('active');}else{document.querySelectorAll('.panel-tab-btn')[1].classList.add('active');document.getElementById('view-recovery').classList.add('active');renderRecovery();}}
        function toggleSet(e,id,el){e.stopPropagation(); if(el.classList.contains('completed')){el.classList.remove('completed');localStorage.removeItem(id);}else{el.classList.add('completed');localStorage.setItem(id,'true');}}
        function saveJournal(){localStorage.setItem(`j_w${currentWeek}_${currentDay}`,document.getElementById('journal-input').value);document.getElementById('save-msg').innerText="Saved";}
        function loadJournal(){document.getElementById('journal-input').value=localStorage.getItem(`j_w${currentWeek}_${currentDay}`)||"";document.getElementById('save-msg').innerText="";}
        function renderRecovery(){
            const c=document.getElementById('recovery-content'); let h=`<span class="rec-type-label">Daily Essentials</span>`;
            recoveryDatabase.general.forEach(t=>h+=card(t)); h+=`<span class="rec-type-label" style="margin-top:24px;">Phase ${currentPhase} Focus</span>`;
            recoveryDatabase[currentPhase].forEach(t=>h+=card(t)); c.innerHTML=h;
        }
        function card(t){return `<div class="rec-card"><div class="rec-icon-title"><span class="rec-icon">${t.icon}</span><span class="rec-title-en">${t.titleEn}</span><span class="rec-title-cn">${t.titleCn}</span></div><div class="rec-desc-en">${t.descEn}</div><div class="rec-desc-cn">${t.descCn}</div></div>`;}
        function speak(t){window.speechSynthesis.cancel(); let u=new SpeechSynthesisUtterance(t); let z=window.speechSynthesis.getVoices().find(v=>v.lang.indexOf('zh')>=0); if(z)u.voice=z; window.speechSynthesis.speak(u);}
    </script>
</body>
</html>